// Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÛµÛ° Ù„ØºØª Ø§ÙˆÙ„ A1 Ø¨Ø§ ØªØ¹Ø§Ø±ÛŒÙ Ø³Ø§Ø¯Ù‡
const DICTIONARY_DB = {
    "be": {
        word: "be",
        persian: "Ø¨ÙˆØ¯Ù†",
        english: "to exist",
        examples: ["I am a student.", "She is happy."],
        collocations: ["be good", "be here", "be happy"],
        phrasalVerbs: [{verb: "be up", meaning: "Ø¨ÛŒØ¯Ø§Ø± Ø¨ÙˆØ¯Ù†", example: "I am up at 7 AM."}],
        phrases: [{phrase: "be careful", meaning: "Ù…Ø±Ø§Ù‚Ø¨ Ø¨Ø§Ø´", example: "Be careful on the road."}],
        level: "A1"
    },
    "have": {
        word: "have",
        persian: "Ø¯Ø§Ø´ØªÙ†",
        english: "to own",
        examples: ["I have a book.", "They have a car."],
        collocations: ["have a car", "have time", "have food"],
        phrasalVerbs: [{verb: "have to", meaning: "Ø¨Ø§ÛŒØ¯", example: "I have to go."}],
        phrases: [{phrase: "have fun", meaning: "Ø®ÙˆØ´ Ø¨Ú¯Ø°Ø±Ù‡", example: "Have fun at the party!"}],
        level: "A1"
    },
    "do": {
        word: "do",
        persian: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†",
        english: "to act",
        examples: ["What do you do?", "I do my work."],
        collocations: ["do work", "do homework", "do exercise"],
        phrasalVerbs: [{verb: "do up", meaning: "Ø¨Ø³ØªÙ†", example: "Do up your shoes."}],
        phrases: [{phrase: "do well", meaning: "Ø®ÙˆØ¨ Ø¹Ù…Ù„ Ú©Ø±Ø¯Ù†", example: "Do well on your test."}],
        level: "A1"
    },
    "go": {
        word: "go",
        persian: "Ø±ÙØªÙ†",
        english: "to move",
        examples: ["I go to school.", "Let's go home."],
        collocations: ["go home", "go to school", "go shopping"],
        phrasalVerbs: [
            {verb: "go on", meaning: "Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø¯Ù†", example: "Please go on."},
            {verb: "go out", meaning: "Ø¨ÛŒØ±ÙˆÙ† Ø±ÙØªÙ†", example: "We go out every Friday."}
        ],
        phrases: [{phrase: "go away", meaning: "Ø¨Ø±Ùˆ", example: "Go away and leave me alone."}],
        level: "A1"
    },
    "come": {
        word: "come",
        persian: "Ø¢Ù…Ø¯Ù†",
        english: "to move here",
        examples: ["Come here, please.", "She comes to work."],
        collocations: ["come here", "come home", "come with me"],
        phrasalVerbs: [
            {verb: "come from", meaning: "Ø§Ù‡Ù„ Ø¬Ø§ÛŒÛŒ Ø¨ÙˆØ¯Ù†", example: "I come from Iran."},
            {verb: "come back", meaning: "Ø¨Ø±Ú¯Ø´ØªÙ†", example: "Come back soon!"}
        ],
        phrases: [{phrase: "come on", meaning: "Ø²ÙˆØ¯ Ø¨Ø§Ø´", example: "Come on, we're late!"}],
        level: "A1"
    },
    "get": {
        word: "get",
        persian: "Ú¯Ø±ÙØªÙ† / Ø´Ø¯Ù†",
        english: "to receive or become",
        examples: ["I get a letter.", "It gets dark."],
        collocations: ["get ready", "get a job", "get home"],
        phrasalVerbs: [
            {verb: "get up", meaning: "Ø¨Ù„Ù†Ø¯ Ø´Ø¯Ù†", example: "I get up at 7."},
            {verb: "get on", meaning: "Ø³ÙˆØ§Ø± Ø´Ø¯Ù†", example: "Get on the bus."}
        ],
        phrases: [{phrase: "get lost", meaning: "Ú¯Ù… Ø´Ø¯Ù†", example: "I get lost in the city."}],
        level: "A1"
    },
    "make": {
        word: "make",
        persian: "Ø³Ø§Ø®ØªÙ†",
        english: "to create",
        examples: ["She makes food.", "I make a plan."],
        collocations: ["make food", "make money", "make friends"],
        phrasalVerbs: [{verb: "make up", meaning: "Ø³Ø§Ø®ØªÙ† (Ø¯Ø§Ø³ØªØ§Ù†)", example: "He makes up stories."}],
        phrases: [{phrase: "make sense", meaning: "Ù…Ù†Ø·Ù‚ÛŒ Ø¨ÙˆØ¯Ù†", example: "That makes sense."}],
        level: "A1"
    },
    "know": {
        word: "know",
        persian: "Ø¯Ø§Ù†Ø³ØªÙ†",
        english: "to have information",
        examples: ["I know him.", "Do you know the answer?"],
        collocations: ["know someone", "know the answer", "know English"],
        phrases: [{phrase: "I don't know", meaning: "Ù†Ù…ÛŒâ€ŒØ¯Ø§Ù†Ù…", example: "I don't know where it is."}],
        level: "A1"
    },
    "think": {
        word: "think",
        persian: "ÙÚ©Ø± Ú©Ø±Ø¯Ù†",
        english: "to use your mind",
        examples: ["I think so.", "What do you think?"],
        collocations: ["think about", "think so", "think fast"],
        phrasalVerbs: [{verb: "think over", meaning: "Ø¯Ø± Ù…ÙˆØ±Ø¯ Ú†ÛŒØ²ÛŒ ÙÚ©Ø± Ú©Ø±Ø¯Ù†", example: "Think over my offer."}],
        phrases: [{phrase: "I think so", meaning: "ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø¢Ø±Ù‡", example: "Is it good? I think so."}],
        level: "A1"
    },
    "say": {
        word: "say",
        persian: "Ú¯ÙØªÙ†",
        english: "to speak words",
        examples: ["She says hello.", "What did you say?"],
        collocations: ["say hello", "say something", "say no"],
        phrases: [{phrase: "that is to say", meaning: "ÛŒØ¹Ù†ÛŒ", example: "He is smart, that is to say, he learns fast."}],
        level: "A1"
    },
    "see": {
        word: "see",
        persian: "Ø¯ÛŒØ¯Ù†",
        english: "to use your eyes",
        examples: ["I see a bird.", "See you tomorrow."],
        collocations: ["see you", "see a movie", "see the doctor"],
        phrasalVerbs: [{verb: "see to", meaning: "Ø±Ø³ÛŒØ¯Ú¯ÛŒ Ú©Ø±Ø¯Ù†", example: "I'll see to the problem."}],
        phrases: [{phrase: "I see", meaning: "Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…", example: "Oh, I see what you mean."}],
        level: "A1"
    },
    "want": {
        word: "want",
        persian: "Ø®ÙˆØ§Ø³ØªÙ†",
        english: "to desire",
        examples: ["I want water.", "She wants to learn."],
        collocations: ["want to go", "want something", "want help"],
        phrases: [{phrase: "I want to", meaning: "Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù…", example: "I want to learn English."}],
        level: "A1"
    },
    "like": {
        word: "like",
        persian: "Ø¯ÙˆØ³Øª Ø¯Ø§Ø´ØªÙ†",
        english: "to enjoy",
        examples: ["I like apples.", "She likes music."],
        collocations: ["like to", "like it", "like someone"],
        phrases: [{phrase: "would like", meaning: "Ù…Ø§ÛŒÙ„ Ø¨ÙˆØ¯Ù†", example: "I would like some tea."}],
        level: "A1"
    },
    "work": {
        word: "work",
        persian: "Ú©Ø§Ø± Ú©Ø±Ø¯Ù†",
        english: "to do a job",
        examples: ["I work every day.", "She works hard."],
        collocations: ["work hard", "work here", "work with"],
        phrasalVerbs: [
            {verb: "work out", meaning: "ÙˆØ±Ø²Ø´ Ú©Ø±Ø¯Ù†", example: "I work out at the gym."},
            {verb: "work on", meaning: "Ø±ÙˆÛŒ Ú†ÛŒØ²ÛŒ Ú©Ø§Ø± Ú©Ø±Ø¯Ù†", example: "I work on my English."}
        ],
        phrases: [{phrase: "work of art", meaning: "Ø§Ø«Ø± Ù‡Ù†Ø±ÛŒ", example: "This painting is a work of art."}],
        level: "A1"
    },
    "need": {
        word: "need",
        persian: "Ù†ÛŒØ§Ø² Ø¯Ø§Ø´ØªÙ†",
        english: "to require",
        examples: ["I need help.", "You need to study."],
        collocations: ["need help", "need time", "need money"],
        phrases: [{phrase: "in need", meaning: "Ù†ÛŒØ§Ø²Ù…Ù†Ø¯", example: "We help people in need."}],
        level: "A1"
    },
    "live": {
        word: "live",
        persian: "Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯Ù†",
        english: "to have life",
        examples: ["I live in Tehran.", "They live happily."],
        collocations: ["live here", "live with", "live well"],
        phrasalVerbs: [{verb: "live on", meaning: "Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø§", example: "We live on rice and bread."}],
        phrases: [{phrase: "live and learn", meaning: "Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ù†ÛŒÙ… Ùˆ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒÙ…", example: "You made a mistake? Live and learn!"}],
        level: "A1"
    },
    "time": {
        word: "time",
        persian: "Ø²Ù…Ø§Ù†",
        english: "minutes, hours, days",
        examples: ["What time is it?", "I have no time."],
        collocations: ["have time", "spend time", "save time"],
        phrases: [
            {phrase: "on time", meaning: "Ø³Ø± ÙˆÙ‚Øª", example: "Please be on time."},
            {phrase: "from time to time", meaning: "Ú¯Ø§Ù‡ÛŒ", example: "I visit them from time to time."}
        ],
        level: "A1"
    },
    "people": {
        word: "people",
        persian: "Ù…Ø±Ø¯Ù…",
        english: "persons",
        examples: ["Many people are here.", "Young people like music."],
        collocations: ["many people", "young people", "old people"],
        phrases: [{phrase: "people say", meaning: "Ù…Ø±Ø¯Ù… Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÙ†Ø¯", example: "People say it's a good school."}],
        level: "A1"
    },
    "good": {
        word: "good",
        persian: "Ø®ÙˆØ¨",
        english: "nice, not bad",
        examples: ["She is a good student.", "This is good food."],
        collocations: ["good morning", "good idea", "good job"],
        phrases: [{phrase: "good for you", meaning: "Ø¢ÙØ±ÛŒÙ†", example: "You passed the test? Good for you!"}],
        level: "A1"
    },
    "day": {
        word: "day",
        persian: "Ø±ÙˆØ²",
        english: "24 hours",
        examples: ["I work every day.", "Have a good day!"],
        collocations: ["every day", "good day", "long day"],
        phrases: [
            {phrase: "day after day", meaning: "Ù‡Ø± Ø±ÙˆØ²", example: "Day after day, I study English."},
            {phrase: "one day", meaning: "ÛŒÚ© Ø±ÙˆØ²", example: "One day, I will visit Paris."}
        ],
        level: "A1"
    },
    "hello": {
        word: "hello",
        persian: "Ø³Ù„Ø§Ù…",
        english: "greeting",
        examples: ["Hello, how are you?", "She says hello."],
        collocations: ["say hello", "hello there", "hello everyone"],
        phrases: [],
        level: "A1"
    }
};

// ØªØ§Ø¨Ø¹ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡
function searchWord(word) {
    const wordLower = word.toLowerCase().trim();
    
    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…
    if (DICTIONARY_DB[wordLower]) {
        return DICTIONARY_DB[wordLower];
    }
    
    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´Ø§Ø¨Ù‡
    const similarWords = [];
    for (const key in DICTIONARY_DB) {
        if (key.startsWith(wordLower) || wordLower.startsWith(key)) {
            similarWords.push({
                word: key,
                meaning: DICTIONARY_DB[key].persian
            });
        }
    }
    
    if (similarWords.length > 0) {
        return {
            word: wordLower,
            suggestions: similarWords.slice(0, 3),
            message: "Ø¢ÛŒØ§ Ù…Ù†Ø¸ÙˆØ± Ø´Ù…Ø§ ÛŒÚ©ÛŒ Ø§Ø² Ø§ÛŒÙ†â€ŒÙ‡Ø§Ø³ØªØŸ"
        };
    }
    
    return null;
}

// ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¯Ø± HTML
function displayWordResult(wordData) {
    const resultsArea = document.getElementById('resultsArea');
    if (!resultsArea) return;
    
    if (wordData.suggestions) {
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
        let suggestionsHtml = wordData.suggestions.map(s => `
            <div class="suggestion-item" onclick="selectSuggestion('${s.word}')">
                <strong>${s.word}</strong>
                <span>${s.meaning}</span>
                <i class="fas fa-arrow-left"></i>
            </div>
        `).join('');
        
        resultsArea.innerHTML = `
            <div class="suggestions-container">
                <h3>${wordData.message}</h3>
                <div class="suggestions-list">
                    ${suggestionsHtml}
                </div>
            </div>
        `;
        return;
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ù„ØºØª
    const word = wordData.word;
    const persian = wordData.persian;
    const english = wordData.english;
    const examples = wordData.examples || [];
    const collocations = wordData.collocations || [];
    const phrasalVerbs = wordData.phrasalVerbs || [];
    const phrases = wordData.phrases || [];
    
    // Ø³Ø§Ø®Øª HTML
    let examplesHtml = '';
    if (examples.length > 0) {
        examplesHtml = examples.map(ex => `
            <div class="example-item">
                <div class="example-en">${ex}</div>
            </div>
        `).join('');
    }
    
    let collocationsHtml = '';
    if (collocations.length > 0) {
        collocationsHtml = `
            <div class="section">
                <h4><i class="fas fa-link"></i> Ú©Ø§Ù„ÙˆÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§</h4>
                <div class="tags">
                    ${collocations.map(coll => `
                        <span class="tag">${coll}</span>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    let phrasalVerbsHtml = '';
    if (phrasalVerbs.length > 0) {
        phrasalVerbsHtml = `
            <div class="section">
                <h4><i class="fas fa-random"></i> Ø§ÙØ¹Ø§Ù„ Ù…Ø±Ú©Ø¨</h4>
                ${phrasalVerbs.map(pv => `
                    <div class="phrasal-verb">
                        <strong>${pv.verb}</strong>
                        <span>${pv.meaning}</span>
                        <div class="example">Ù…Ø«Ø§Ù„: ${pv.example}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    let phrasesHtml = '';
    if (phrases.length > 0) {
        phrasesHtml = `
            <div class="section">
                <h4><i class="fas fa-quote-right"></i> Ø¹Ø¨Ø§Ø±Ø§Øª</h4>
                ${phrases.map(ph => `
                    <div class="phrase">
                        <strong>${ph.phrase}</strong>
                        <span>${ph.meaning}</span>
                        <div class="example">Ù…Ø«Ø§Ù„: ${ph.example}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    resultsArea.innerHTML = `
        <div class="word-card">
            <div class="word-header">
                <h2 class="word">${word}</h2>
                <button class="play-btn" onclick="playWordSound('${word}')">
                    <i class="fas fa-volume-up"></i> Ù¾Ø®Ø´ ØµÙˆØª
                </button>
            </div>
            
            <div class="word-info">
                <div class="meaning">
                    <strong>ÙØ§Ø±Ø³ÛŒ:</strong> ${persian}
                </div>
                <div class="definition">
                    <strong>ØªØ¹Ø±ÛŒÙ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ:</strong> ${english}
                </div>
            </div>
            
            ${examplesHtml ? `
            <div class="section">
                <h4><i class="fas fa-comment"></i> Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§</h4>
                <div class="examples">${examplesHtml}</div>
            </div>` : ''}
            
            ${collocationsHtml}
            ${phrasalVerbsHtml}
            ${phrasesHtml}
            
            <div class="word-footer">
                <span class="level">Ø³Ø·Ø­: ${wordData.level}</span>
                <button class="save-btn" onclick="addToLeitner('${word}')">
                    <i class="far fa-star"></i> Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù„Ø§ÛŒØªÙ†Ø±
                </button>
            </div>
        </div>
    `;
}

// ØªØ§Ø¨Ø¹ Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯
function selectSuggestion(word) {
    document.getElementById('wordInput').value = word;
    searchAndDisplay(word);
}

// ØªØ§Ø¨Ø¹ Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ù†Ù…Ø§ÛŒØ´
function searchAndDisplay(word) {
    const result = searchWord(word);
    if (result) {
        displayWordResult(result);
        
        // Ù¾Ø®Ø´ ØµÙˆØª
        if (window.TTSSystem && window.TTSSystem.isEnabled) {
            window.TTSSystem.speakWord(word);
        }
    } else {
        document.getElementById('resultsArea').innerHTML = `
            <div class="no-results">
                <i class="fas fa-search"></i>
                <h3>Ù„ØºØª "${word}" ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
                <p>Ù…Ø·Ù…Ø¦Ù† Ø¨Ø§Ø´ÛŒØ¯ Ø§Ù…Ù„Ø§ÛŒ Ø¢Ù† Ø¯Ø±Ø³Øª Ø§Ø³Øª.</p>
            </div>
        `;
    }
}

// ØªØ§Ø¨Ø¹ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„Ø§ÛŒØªÙ†Ø±
function addToLeitner(word) {
    const wordData = searchWord(word);
    if (wordData && window.LeitnerSystem) {
        window.LeitnerSystem.addWord(word, wordData.persian, wordData.examples);
        alert(`"${word}" Ø¨Ù‡ Ù„Ø§ÛŒØªÙ†Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!`);
    }
}

// ØªØ§Ø¨Ø¹ Ù¾Ø®Ø´ ØµÙˆØª
function playWordSound(word) {
    if (window.TTSSystem) {
        window.TTSSystem.speakWord(word);
    }
}

// Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØµÙØ­Ù‡
document.addEventListener('DOMContentLoaded', function() {
    const searchBtn = document.getElementById('searchBtn');
    const wordInput = document.getElementById('wordInput');
    
    if (searchBtn && wordInput) {
        searchBtn.addEventListener('click', function() {
            const word = wordInput.value.trim();
            if (word) {
                searchAndDisplay(word);
            }
        });
        
        wordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const word = wordInput.value.trim();
                if (word) {
                    searchAndDisplay(word);
                }
            }
        });
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯
    const resultsArea = document.getElementById('resultsArea');
    if (resultsArea && !resultsArea.innerHTML) {
        resultsArea.innerHTML = `
            <div class="welcome-card">
                <i class="fas fa-language"></i>
                <h3>Ø¨Ù‡ Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ A1 Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h3>
                <p>ÛŒÚ© Ù„ØºØª Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„: hello, go, have)</p>
                <div class="suggestions">
                    <button onclick="searchAndDisplay('hello')">hello</button>
                    <button onclick="searchAndDisplay('go')">go</button>
                    <button onclick="searchAndDisplay('have')">have</button>
                    <button onclick="searchAndDisplay('good')">good</button>
                </div>
            </div>
        `;
    }
});

// ØµØ§Ø¯Ø± Ú©Ø±Ø¯Ù† ØªÙˆØ§Ø¨Ø¹ Ø¨Ù‡ window
window.searchWord = searchWord;
window.displayWordResult = displayWordResult;
window.selectSuggestion = selectSuggestion;
window.searchAndDisplay = searchAndDisplay;
window.addToLeitner = addToLeitner;
window.playWordSound = playWordSound;

console.log("ğŸ“˜ Dictionary loaded with " + Object.keys(DICTIONARY_DB).length + " A1 words");
