<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fred Practice Elite</title>
    <style>
        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ ØªÙ… Ø´Ø¨ (Ø®Ø§Ú©Ø³ØªØ±ÛŒ ØªÛŒØ±Ù‡) Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ */
        :root { 
            --bg: #2d3436; /* Ø®Ø§Ú©Ø³ØªØ±ÛŒ ØªÛŒØ±Ù‡ */
            --text: #dfe6e9; /* Ù…ØªÙ† Ø±ÙˆØ´Ù† */
            --accent: #81ecec; /* Ø±Ù†Ú¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
            --shadow: 10px 10px 20px #1e2223, -10px -10px 20px #3c4649;
            --inner: inset 6px 6px 12px #1e2223, inset -6px -6px 12px #3c4649;
        }

        body { 
            background-color: var(--bg) !important; 
            color: var(--text) !important; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            margin: 0; padding: 15px; 
            /* ÙÙˆÙ†Øª Ø¨Ø³ÛŒØ§Ø± Ø¯Ø±Ø´Øª Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ */
            font-size: 30px !important; 
            line-height: 1.6;
            overflow-x: hidden;
        }

        .neu-card { 
            background: var(--bg); 
            border-radius: 30px; 
            box-shadow: var(--shadow); 
            padding: 30px; 
            margin-bottom: 25px; 
            text-align: center; 
        }

        .neu-btn { 
            border: none; 
            background: var(--bg); 
            box-shadow: var(--shadow); 
            padding: 20px; 
            border-radius: 20px; 
            cursor: pointer; 
            color: var(--accent); 
            font-weight: bold; 
            font-size: 1.1em; 
            transition: 0.2s; 
            width: 100%;
            margin: 10px 0;
        }

        .neu-btn:active { box-shadow: var(--inner); transform: scale(0.95); }

        /* Ø¯Ú©Ù…Ù‡ Ø®Ø±ÙˆØ¬ Ù‚Ø±Ù…Ø² Ø±Ù†Ú¯ */
        .btn-exit { 
            color: #ff7675 !important; 
            font-size: 0.8em;
            box-shadow: 5px 5px 10px #1e2223, -5px -5px 10px #3c4649;
        }

        .en-text { 
            direction: ltr; 
            font-size: 1.5em; 
            color: #fff;
            margin: 30px 0;
            display: block;
            font-weight: bold;
        }

        .hidden { display: none !important; }
        
        #header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .small-btn {
            width: 80px !important;
            padding: 10px !important;
            font-size: 0.7em !important;
        }
    </style>
</head>
<body>

    <div id="header-bar">
        <button id="muteBtn" class="neu-btn small-btn" onclick="app.toggleMute()">ğŸ”Š Mute</button>
        <button class="neu-btn small-btn btn-exit" onclick="app.exitApp()">âœ– Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="mainApp">
        <div id="homeMenu">
            <div class="neu-card">
                <h1 style="color: var(--accent);">Fred Elite</h1>
                <p style="font-size: 0.8em;">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¨Ø§ ÙÙˆÙ†Øª Ø¯Ø±Ø´Øª Ùˆ ØªÙ… Ø´Ø¨</p>
                <button class="neu-btn" onclick="app.startQuiz()">ğŸ“ Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ†</button>
            </div>
        </div>

        <div id="quizArea" class="hidden">
            <div class="neu-card">
                <div id="qText" class="en-text"></div>
                <div id="qOptions"></div>
                <div id="qFeedback" class="hidden" style="margin-top:20px; font-size: 0.9em;"></div>
            </div>
        </div>
    </div>

    <script src="dictionary.js"></script>
    <script>
        const PROXY_URL = "https://script.google.com/macros/s/AKfycbwpS34Rfd59aIpCger7MC2ggs0WyaIxlcfHQ_AjkDevV22HtbkuP-jKcKysNIj0LWwb/exec";

        class FredApp {
            constructor() {
                this.qIndex = 0;
                this.mistakes = [];
                this.isMuted = false;
                this.currentQ = null;
            }

            toggleMute() {
                this.isMuted = !this.isMuted;
                document.getElementById('muteBtn').innerText = this.isMuted ? "ğŸ”‡ Unmute" : "ğŸ”Š Mute";
                document.getElementById('muteBtn').style.color = this.isMuted ? "#b2bec3" : "#81ecec";
            }

            speak(text) {
                if (!this.isMuted && 'speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'en-US';
                    u.rate = 0.75; // Ú©Ù…ÛŒ Ø¢Ø±Ø§Ù…â€ŒØªØ± Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¨Ù‡ØªØ±
                    window.speechSynthesis.speak(u);
                }
            }

            exitApp() {
                if (confirm("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯ÛŒØ¯ØŸ")) {
                    location.reload();
                }
            }

            startQuiz() {
                document.getElementById('homeMenu').classList.add('hidden');
                document.getElementById('quizArea').classList.remove('hidden');
                this.activePool = [...dictionary].sort(() => 0.5 - Math.random());
                this.qIndex = 0;
                this.nextQuestion();
            }

            nextQuestion() {
                if (this.qIndex >= 10) {
                    this.finishRound();
                    return;
                }
                
                this.qIndex++;
                this.currentQ = this.activePool.pop();
                
                // ØªÙ„ÙØ¸ Ø®ÙˆØ¯Ú©Ø§Ø±
                this.speak(this.currentQ.en);

                let wrongs = dictionary.filter(i => i.en !== this.currentQ.en).sort(() => 0.5 - Math.random()).slice(0, 2);
                let opts = [this.currentQ, ...wrongs].sort(() => 0.5 - Math.random());

                // Ù†Ù…Ø§ÛŒØ´ Ø³ÙˆØ§Ù„
                document.getElementById('qText').innerText = this.currentQ.ex.replace(new RegExp(this.currentQ.en, 'gi'), "_______");
                
                const container = document.getElementById('qOptions');
                container.innerHTML = "";
                opts.forEach(o => {
                    const btn = document.createElement('button');
                    btn.className = 'neu-btn';
                    btn.innerText = o.en;
                    btn.onclick = () => this.check(o.en);
                    container.appendChild(btn);
                });
            }

            check(chosen) {
                const fb = document.getElementById('qFeedback');
                fb.classList.remove('hidden');
                
                if (chosen === this.currentQ.en) {
                    fb.innerText = "âœ… EXCELLENT!";
                    fb.style.color = "#55efc4";
                } else {
                    fb.innerText = `âŒ CORRECT: ${this.currentQ.en}`;
                    fb.style.color = "#ff7675";
                    this.mistakes.push(this.currentQ);
                    this.speak(this.currentQ.en);
                }

                setTimeout(() => {
                    fb.classList.add('hidden');
                    this.nextQuestion();
                }, 1800);
            }

            finishRound() {
                // Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
                const msg = `ğŸ“Š Ú¯Ø²Ø§Ø±Ø´: ÙÙˆÙ†Ø¯ Ø¯Ø±Ø´Øª\nØ§Ø´ØªØ¨Ø§Ù‡Ø§Øª: ${this.mistakes.length}`;
                fetch(PROXY_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ message: msg }) });
                
                alert(`ØªÙ…Ø±ÛŒÙ† ØªÙ…Ø§Ù… Ø´Ø¯!\nØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª: ${this.mistakes.length}`);
                location.reload();
            }
        }

        const app = new FredApp();
    </script>
</body>
</html>
