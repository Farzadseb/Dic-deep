<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dic-Deep Elite</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">

    <style>
        :root { 
            --bg: #e0e5ec; 
            --accent: #4a90e2; 
            --main-word: #000000; 
            --text: #444; 
            --shadow: 9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5); 
        }
        body.dark { 
            --bg: #2d3436; 
            --accent: #4facfe; 
            --main-word: #ffffff; 
            --text: #eee; 
            --shadow: 5px 5px 10px #23282a, -5px -5px 10px #374042;
        }
        body { background: var(--bg); font-family: Tahoma, sans-serif; transition: 0.3s; padding: 20px; margin: 0; color: var(--text); touch-action: manipulation; }
        .neu-card { background: var(--bg); border-radius: 25px; box-shadow: var(--shadow); padding: 25px; margin-bottom: 25px; text-align: center; }
        .neu-btn { border: none; background: var(--bg); box-shadow: var(--shadow); padding: 15px 20px; border-radius: 15px; cursor: pointer; color: var(--accent); font-weight: bold; transition: 0.2s; }
        .neu-btn:active { transform: scale(0.96); box-shadow: inset 4px 4px 8px #b8bec5; }
        .search-input { width: 100%; border: none; background: var(--bg); box-shadow: inset 6px 6px 12px #b8bec5, inset -6px -6px 12px #ffffff; padding: 18px; border-radius: 20px; outline: none; color: var(--accent); font-size: 16px; text-align: center; box-sizing: border-box; }
        .main-word-style { color: var(--main-word); font-size: 1.5em; font-weight: 900; direction: ltr; display: inline-block; }
        .example-box { font-size: 0.85em; background: rgba(0,0,0,0.03); padding: 15px; border-radius: 15px; margin-top: 15px; text-align: left; direction: ltr; border-left: 4px solid var(--accent); }
        .hidden { display: none !important; }
    </style>
</head>
<body class="light">

    <div class="neu-card">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <div>Score: <span id="scoreDisp">0</span></div>
            <button class="neu-btn" onclick="app.toggleTheme()">ğŸŒ“</button>
            <div>â­ <span id="starDisp">0</span></div>
        </div>
    </div>

    <div id="vipArea" class="neu-card">
        <h3>ÙˆØ±ÙˆØ¯ VIP</h3>
        <input type="text" id="vipCode" class="search-input" placeholder="Ú©Ø¯ ÙˆØ±ÙˆØ¯">
        <button class="neu-btn" style="margin-top:20px; width:100%;" onclick="app.checkVIP()">ØªØ§ÛŒÛŒØ¯</button>
    </div>

    <div id="mainContent" class="hidden">
        <div class="neu-card">
            <input type="text" id="wordInput" class="search-input" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ..." oninput="app.liveSearch()">
            <div id="results" style="margin-top: 20px;"></div>
        </div>
        <div class="neu-card">
            <h3 id="quizQ"></h3>
            <div id="options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;"></div>
            <button id="startBtn" class="neu-btn" style="width:100%; margin-top:15px;" onclick="app.startQuiz()">Ø´Ø±ÙˆØ¹ Ù…Ø³Ø§Ø¨Ù‚Ù‡</button>
        </div>
    </div>

    <script src="dictionary.js"></script>
    <script>
        class DicDeepApp {
            constructor() {
                this.score = 0; this.stars = 0; this.testCount = 0; this.theme = 'light';
                this.fallbackDict = [{ en: "usually", fa: "Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹", ex: "I usually go home at 5.", col: "as usually", phr: "---" }];
                window.app = this;
            }

            speak(text) {
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = 'en-US';
                window.speechSynthesis.speak(msg);
            }

            toggleTheme() { 
                this.theme = this.theme === 'light' ? 'dark' : 'light'; 
                document.body.className = this.theme; 
            }

            checkVIP() {
                const val = document.getElementById('vipCode').value.trim().toUpperCase();
                if (val === "FRED-2025") {
                    document.getElementById('vipArea').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    this.sendLog("ğŸš€ ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†");
                } else { alert("Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!"); }
            }

            liveSearch() {
                const term = document.getElementById('wordInput').value.toLowerCase().trim();
                const res = document.getElementById('results'); res.innerHTML = "";
                if(!term) return;
                const data = (typeof dictionary !== 'undefined') ? dictionary : this.fallbackDict;
                data.filter(w => w.en.toLowerCase().includes(term) || w.fa.includes(term)).slice(0,3).forEach(w => {
                    res.innerHTML += `
                    <div class="neu-card" style="box-shadow:none; border:1px solid rgba(0,0,0,0.05); text-align:right;">
                        <div onclick="app.speak('${w.en}')" style="cursor:pointer;"><span class="main-word-style">${w.en}</span> ğŸ”Š</div>
                        <div><b>Ù…Ø¹Ù†ÛŒ:</b> ${w.fa}</div>
                        <div style="font-size:0.8em; color:gray;">Col: ${w.col} | Phr: ${w.phr}</div>
                        <div class="example-box">${w.ex}</div>
                    </div>`;
                });
            }

            startQuiz() {
                document.getElementById('startBtn').classList.add('hidden');
                const data = (typeof dictionary !== 'undefined') ? dictionary : this.fallbackDict;
                const correct = data[Math.floor(Math.random() * data.length)];
                this.speak(correct.en);
                
                let opts = [correct];
                while(opts.length < 4) {
                    const r = data[Math.floor(Math.random() * data.length)];
                    if(!opts.includes(r)) opts.push(r);
                }
                opts.sort(() => Math.random() - 0.5);

                document.getElementById('quizQ').innerHTML = `Ù…Ø¹Ù†ÛŒ <span class="main-word-style">"${correct.en}"?</span> Ú†ÛŒØ³ØªØŸ`;
                
                const div = document.getElementById('options'); div.innerHTML = "";
                opts.forEach(o => {
                    const b = document.createElement('button'); b.className = "neu-btn"; b.innerText = o.fa;
                    b.onclick = () => this.handleAns(o === correct);
                    div.appendChild(b);
                });
            }

            handleAns(isCorrect) {
                if(isCorrect) { 
                    this.score += 20; if(this.score % 100 === 0) this.stars++;
                    document.getElementById('scoreDisp').innerText = this.score;
                    document.getElementById('starDisp').innerText = this.stars;
                    this.testCount++;
                    if(this.testCount >= 5) { this.showModal(); this.testCount = 0; } else { this.startQuiz(); }
                } else { alert("Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨ÙˆØ¯!"); this.startQuiz(); }
            }

            showModal() {
                const m = document.createElement('div');
                m.id = "modalWrap";
                m.innerHTML = `
                <div style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:2000; width:85%; max-width:320px; padding:30px; border-radius:30px; background:var(--bg); box-shadow: var(--shadow); text-align:center;">
                    <h2 style="color:var(--accent);">Ù¾ÛŒØ´Ø±ÙØª Ø¹Ø§Ù„ÛŒ!</h2>
                    <p>Ø¨Ø±Ø§ÛŒ Ú©Ù„Ø§Ø³ Ø®ØµÙˆØµÛŒ Ø¨Ø§ Ù…Ù† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±.</p>
                    <div style="display:flex; justify-content:space-around; margin-top:25px;">
                        <a href="https://wa.me/989017708544" style="text-decoration:none;"><button class="neu-btn" style="background:#25D366; color:white;">WhatsApp</button></a>
                        <a href="tel:09017708544" style="text-decoration:none;"><button class="neu-btn" style="background:var(--accent); color:white;">Call</button></a>
                    </div>
                    <button class="neu-btn" onclick="document.getElementById('modalWrap').remove(); app.startQuiz();" style="margin-top:30px; width:100%;">Ø§Ø¯Ø§Ù…Ù‡</button>
                </div>
                <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); backdrop-filter:blur(5px); z-index:1999;"></div>`;
                document.body.appendChild(m);
            }

            async sendLog(msg) {
                const url = `https://api.telegram.org/bot553224514:AAG0XXzA8da55jCGXnzStP-0IxHhnfkTPRw/sendMessage?chat_id=969918598&text=${encodeURIComponent(msg)}`;
                try { fetch(url); } catch(e) {}
            }
        }
        const app = new DicDeepApp();
    </script>
</body>
</html>
