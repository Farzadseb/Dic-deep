<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Fred Elite Compact</title>
    <style>
        :root { 
            --bg: #1a1a1a; --text: #eeeeee; --accent: #00d2ff;
            --shadow: 4px 4px 8px #0a0a0a, -4px -4px 8px #2a2a2a;
            --inner: inset 3px 3px 6px #0a0a0a, inset -3px -3px 6px #2a2a2a;
        }
        html, body {
            background-color: var(--bg) !important; color: var(--text) !important;
            font-family: 'Segoe UI', Tahoma, sans-serif !important;
            font-size: 14px !important; margin: 0; padding: 5px; height: 100%;
        }
        .header-bar { display: flex; justify-content: space-between; padding: 5px 10px; align-items: center; }
        .neu-btn {
            background: #222; border: none; padding: 8px 12px; border-radius: 10px;
            color: var(--accent); font-weight: bold; font-size: 11px; box-shadow: var(--shadow); cursor: pointer;
        }
        .btn-exit { color: #ff4d4d !important; }
        .card {
            background: #1a1a1a; padding: 12px; border-radius: 15px;
            box-shadow: var(--shadow); text-align: center; margin-top: 8px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„ ÙÛŒÙ„Ø¯ Ø¬Ø³ØªØ¬Ùˆ Ù…Ø´Ø§Ø¨Ù‡ ØªØµÙˆÛŒØ± Ø³ÙˆÙ… */
        .search-box {
            width: 100%; border: none; background: #222; box-shadow: var(--inner);
            padding: 10px; border-radius: 20px; color: white; outline: none;
            text-align: center; margin-bottom: 10px; font-size: 13px;
        }
        .word-display { 
            text-align: left; direction: ltr; padding: 10px; 
            border-radius: 12px; background: #222; box-shadow: var(--inner); margin-bottom: 5px;
        }
        .en-title { font-size: 18px; color: var(--accent); font-weight: bold; }
        .fa-title { float: right; direction: rtl; color: #ff4d4d; font-size: 14px; }
        .example { font-size: 12px; color: #bbb; margin-top: 5px; }
        .hidden { display: none !important; }
        .grid-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="header-bar">
    <button id="muteBtn" class="neu-btn" onclick="app.toggleMute()">ğŸ”Š Mute</button>
    <div style="font-size: 10px; opacity: 0.7;">Fred Elite v2</div>
    <button class="neu-btn btn-exit" onclick="app.exit()">âœ– Ø®Ø±ÙˆØ¬</button>
</div>

<div id="home">
    <div class="card">
        <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ù„ØºØª (Go...)" oninput="app.search()">
        
        <div id="searchResult" class="hidden"></div>

        <div class="grid-btns">
            <button class="neu-btn" style="background: #1565c0; color: white;" onclick="app.startQuiz()">ğŸ“ ØªÙ…Ø±ÛŒÙ†</button>
            <button class="neu-btn" style="background: #2e7d32; color: white;">ğŸ“‚ Ù„Ø§ÛŒØªÙ†Ø±</button>
            <button class="neu-btn" style="background: #6a1b9a; color: white;">ğŸ’ VIP</button>
            <button class="neu-btn" style="background: #ef6c00; color: white;">ğŸ® Ù…Ø³Ø§Ø¨Ù‚Ù‡</button>
        </div>
    </div>
</div>

<div id="quiz" class="hidden">
    <div class="card">
        <div id="qText" style="font-size: 18px; direction: ltr; margin: 15px 0;"></div>
        <div id="qOptions" style="display: grid; gap: 8px;"></div>
        <div id="feedback" style="margin-top: 10px; font-size: 12px; font-weight: bold;"></div>
    </div>
</div>

<script>
    // Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø´
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(rs => { for(let r of rs) r.unregister(); });
    }

    // Ù„ÙˆØ¯ Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø§ Ú©Ø¯ Ø¶Ø¯ Ú©Ø´
    const s = document.createElement('script');
    s.src = 'dictionary.js?v=' + Date.now();
    document.head.appendChild(s);

    const app = {
        isMuted: false, currentWord: null,

        toggleMute() {
            this.isMuted = !this.isMuted;
            document.getElementById('muteBtn').innerText = this.isMuted ? "ğŸ”‡ Unmute" : "ğŸ”Š Mute";
        },

        exit() { if(confirm("Ø¨Ø§Ø²Ú¯Ø´ØªØŸ")) location.reload(); },

        search() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const resDiv = document.getElementById('searchResult');
            if(!term) { resDiv.classList.add('hidden'); return; }
            
            const found = dictionary.find(w => w.en.toLowerCase() === term || w.fa.includes(term));
            if(found) {
                resDiv.classList.remove('hidden');
                resDiv.innerHTML = `
                    <div class="word-display">
                        <span class="fa-title">${found.fa}</span>
                        <div class="en-title">${found.en.toUpperCase()}</div>
                        <div class="example"><b>Def:</b> ${found.def || '...'}</div>
                        <div class="example" style="color:#00ff88"><b>Ex:</b> ${found.ex}</div>
                    </div>
                `;
                if(!this.isMuted) this.speak(found.en);
            } else { resDiv.classList.add('hidden'); }
        },

        speak(t) {
            if(!this.isMuted && 'speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(t);
                u.lang = 'en-US'; u.rate = 0.8;
                window.speechSynthesis.speak(u);
            }
        },

        startQuiz() {
            document.getElementById('home').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            this.nextQ();
        },

        nextQ() {
            const w = dictionary[Math.floor(Math.random() * dictionary.length)];
            this.currentWord = w;
            this.speak(w.en);
            document.getElementById('qText').innerText = w.ex.replace(new RegExp(w.en, 'gi'), "___");
            let opts = [w, ...dictionary.filter(d=>d.en!==w.en).slice(0,2)].sort(()=>0.5-Math.random());
            const cont = document.getElementById('qOptions');
            cont.innerHTML = "";
            opts.forEach(o => {
                const b = document.createElement('button');
                b.className = 'neu-btn';
                b.style.width = "100%";
                b.innerText = o.en;
                b.onclick = () => this.check(o.en);
                cont.appendChild(b);
            });
        },

        check(ans) {
            const f = document.getElementById('feedback');
            const isC = ans === this.currentWord.en;
            f.innerText = isC ? "âœ… Excellent!" : "âŒ " + this.currentWord.en;
            f.style.color = isC ? "#00ff88" : "#ff4d4d";
            if(!isC) this.speak(this.currentWord.en);
            setTimeout(() => { f.innerText = ""; this.nextQ(); }, 1200);
        }
    };
</script>
</body>
</html>
