<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dic-Deep Elite</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">

    <style>
        :root { 
            --bg: #e0e5ec; --accent: #4a90e2; --main-word: #333333; --text: #555; 
            --shadow: 9px 9px 16px rgb(163,177,198,0.5), -9px -9px 16px rgba(255,255,255, 0.6); 
            --inner-shadow: inset 5px 5px 10px #b8bec5, inset -5px -5px 10px #ffffff;
        }
        body.dark { 
            --bg: #2d3436; --accent: #4facfe; --main-word: #ffffff; --text: #ccc; 
            --shadow: 5px 5px 10px #23282a, -5px -5px 10px #374042;
            --inner-shadow: inset 4px 4px 8px #23282a, inset -4px -4px 8px #374042;
        }
        body { background: var(--bg); font-family: Tahoma, sans-serif; transition: 0.3s; padding: 20px; margin: 0; color: var(--text); touch-action: manipulation; }
        
        .neu-card { background: var(--bg); border-radius: 20px; box-shadow: var(--shadow); padding: 22px; margin-bottom: 22px; text-align: center; }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† Ø­Ø§Ù„Øª Ø¨ÙˆÙ„Ø¯ */
        .neu-btn { border: none; background: var(--bg); box-shadow: var(--shadow); padding: 12px 18px; border-radius: 12px; cursor: pointer; color: var(--accent); transition: 0.2s; font-weight: normal; }
        .neu-btn:active { transform: scale(0.97); box-shadow: var(--inner-shadow); }
        
        .search-input { width: 100%; border: none; background: var(--bg); box-shadow: var(--inner-shadow); padding: 15px; border-radius: 15px; outline: none; color: var(--accent); text-align: center; box-sizing: border-box; font-weight: normal; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¸Ø±ÛŒÙ Ø¨Ø±Ø§ÛŒ Ú©Ù„Ù…Ù‡ Ø§ØµÙ„ÛŒ */
        .main-word-style { 
            color: var(--main-word); 
            font-size: 1.25em; 
            font-weight: normal; /* Ø­Ø°Ù Ø­Ø§Ù„Øª Ø¨ÙˆÙ„Ø¯ */
            direction: ltr; 
            display: inline-block;
        }

        .example-box { font-size: 0.85em; background: rgba(0,0,0,0.02); padding: 12px; border-radius: 12px; margin-top: 12px; text-align: left; direction: ltr; border-left: 2px solid var(--accent); }
        .hidden { display: none !important; }
        h3, h2 { font-weight: normal; color: var(--text); }
    </style>
</head>
<body class="light">

    <div class="neu-card">
        <div style="display:flex; justify-content: space-between; align-items: center; font-size: 0.9em;">
            <div>Score: <span id="scoreDisp">0</span></div>
            <button class="neu-btn" onclick="app.toggleTheme()" style="padding: 8px 12px;">ğŸŒ“</button>
            <div>â­ <span id="starDisp">0</span></div>
        </div>
    </div>

    <div id="vipArea" class="neu-card">
        <h3>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„ ELITE</h3>
        <input type="text" id="vipCode" class="search-input" placeholder="Ú©Ø¯ ÙˆØ±ÙˆØ¯">
        <button class="neu-btn" style="margin-top:20px; width:100%;" onclick="app.checkVIP()">ØªØ§ÛŒÛŒØ¯</button>
    </div>

    <div id="mainContent" class="hidden">
        <div class="neu-card">
            <input type="text" id="wordInput" class="search-input" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù„ØºØ§Øª..." oninput="app.liveSearch()">
            <div id="results" style="margin-top: 15px;"></div>
        </div>
        
        <div class="neu-card">
            <div id="quizContainer">
                <h3 id="quizQ" style="margin-bottom: 20px;">Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø±ÙˆØ¹ØŸ</h3>
                <div id="options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;"></div>
            </div>
            <button id="startBtn" class="neu-btn" style="width:100%; margin-top:15px;" onclick="app.startQuiz()">Ø´Ø±ÙˆØ¹ Ù…Ø³Ø§Ø¨Ù‚Ù‡ ØµÙˆØªÛŒ</button>
        </div>
    </div>

    <script src="dictionary.js"></script>
    <script>
        class DicDeepApp {
            constructor() {
                this.score = 0; this.stars = 0; this.testCount = 0; this.theme = 'light';
                this.fallbackDict = [{ en: "usually", fa: "Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹", ex: "I usually go home at 5.", col: "as usually", phr: "---" }];
                window.app = this;
            }

            speak(text) {
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = 'en-US'; msg.rate = 0.85;
                window.speechSynthesis.speak(msg);
            }

            toggleTheme() { 
                this.theme = this.theme === 'light' ? 'dark' : 'light'; 
                document.body.className = this.theme; 
            }

            checkVIP() {
                const val = document.getElementById('vipCode').value.trim().toUpperCase();
                if (val === "FRED-2025") {
                    document.getElementById('vipArea').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    this.sendLog("ğŸš€ User Logged In");
                } else { alert("Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!"); }
            }

            liveSearch() {
                const term = document.getElementById('wordInput').value.toLowerCase().trim();
                const res = document.getElementById('results'); res.innerHTML = "";
                if(!term) return;
                const data = (typeof dictionary !== 'undefined') ? dictionary : this.fallbackDict;
                data.filter(w => w.en.toLowerCase().includes(term) || w.fa.includes(term)).slice(0,3).forEach(w => {
                    res.innerHTML += `
                    <div class="neu-card" style="box-shadow:none; border:1px solid rgba(0,0,0,0.05); text-align:right; padding:12px;">
                        <div onclick="app.speak('${w.en}')" style="cursor:pointer; margin-bottom:5px;">
                            <span class="main-word-style">${w.en}</span> <span style="font-size:0.8em; color:var(--accent);">ğŸ”Š</span>
                        </div>
                        <div style="font-size:0.95em;">Ù…Ø¹Ù†ÛŒ: ${w.fa}</div>
                        <div style="font-size:0.75em; color:gray; margin-top:5px;">Col: ${w.col || '---'} | Phr: ${w.phr || '---'}</div>
                        <div class="example-box">${w.ex}</div>
                    </div>`;
                });
            }

            startQuiz() {
                document.getElementById('startBtn').classList.add('hidden');
                const data = (typeof dictionary !== 'undefined') ? dictionary : this.fallbackDict;
                const correct = data[Math.floor(Math.random() * data.length)];
                this.speak(correct.en);
                let opts = [correct];
                while(opts.length < 4) {
                    const r = data[Math.floor(Math.random() * data.length)];
                    if(!opts.includes(r)) opts.push(r);
                }
                opts.sort(() => Math.random() - 0.5);

                // Ø¹Ù„Ø§Ù…Øª Ø³ÙˆØ§Ù„ Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ Ùˆ Ú©Ù„Ù…Ù‡ Ø¨Ø¯ÙˆÙ† Ø¨ÙˆÙ„Ø¯
                document.getElementById('quizQ').innerHTML = `Ù…Ø¹Ù†ÛŒ <span class="main-word-style">"${correct.en}"?</span> Ú†ÛŒØ³ØªØŸ`;
                
                const div = document.getElementById('options'); div.innerHTML = "";
                opts.forEach(o => {
                    const b = document.createElement('button'); b.className = "neu-btn"; b.innerText = o.fa;
                    b.onclick = () => this.handleAns(o === correct);
                    div.appendChild(b);
                });
            }

            handleAns(isCorrect) {
                if(isCorrect) { 
                    this.score += 20; if(this.score % 100 === 0) this.stars++;
                    document.getElementById('scoreDisp').innerText = this.score;
                    document.getElementById('starDisp').innerText = this.stars;
                    this.testCount++;
                    if(this.testCount >= 5) { this.showModal(); this.testCount = 0; } else { this.startQuiz(); }
                } else { this.startQuiz(); }
            }

            showModal() {
                const m = document.createElement('div');
                m.id = "modalWrap";
                m.innerHTML = `
                <div style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:2000; width:80%; max-width:300px; padding:25px; border-radius:20px; background:var(--bg); box-shadow: var(--shadow); text-align:center;">
                    <h3 style="color:var(--accent);">Ù¾ÛŒØ´Ø±ÙØª Ø¹Ø§Ù„ÛŒ</h3>
                    <p style="font-size:0.9em;">Ø¨Ø±Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ù…Ú©Ø§Ù„Ù…Ù‡ Ø¨Ø§ Ù…Ù† Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ø´.</p>
                    <div style="display:flex; justify-content:space-around; margin-top:20px;">
                        <a href="https://wa.me/989017708544" style="text-decoration:none;"><button class="neu-btn">WhatsApp</button></a>
                        <a href="tel:09017708544" style="text-decoration:none;"><button class="neu-btn">Call</button></a>
                    </div>
                    <button class="neu-btn" onclick="document.getElementById('modalWrap').remove(); app.startQuiz();" style="margin-top:25px; width:100%;">Ø§Ø¯Ø§Ù…Ù‡</button>
                </div><div style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:1999; backdrop-filter:blur(3px);"></div>`;
                document.body.appendChild(m);
            }

            async sendLog(msg) {
                const url = `https://api.telegram.org/bot553224514:AAG0XXzA8da55jCGXnzStP-0IxHhnfkTPRw/sendMessage?chat_id=969918598&text=${encodeURIComponent(msg)}`;
                try { fetch(url); } catch(e) {}
            }
        }
        const app = new DicDeepApp();
    </script>
</body>
</html>
