<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Fred Elite Compact</title>
    <style>
        :root { 
            --bg: #1a1a1a;
            --text: #eeeeee;
            --accent: #00d2ff;
            --shadow: 4px 4px 8px #0a0a0a, -4px -4px 8px #2a2a2a;
        }

        html, body {
            background-color: var(--bg) !important;
            color: var(--text) !important;
            font-family: 'Segoe UI', Tahoma, sans-serif !important;
            font-size: 14px !important; 
            margin: 0; padding: 5px;
            height: 100%;
        }

        .header-bar { display: flex; justify-content: space-between; padding: 5px 10px; }

        .neu-btn {
            background: #222222; border: none; padding: 8px 12px; 
            border-radius: 8px; color: var(--accent); font-weight: bold;
            font-size: 12px; box-shadow: var(--shadow); cursor: pointer;
        }

        .btn-exit { color: #ff4d4d !important; }

        .card {
            background: #1a1a1a; padding: 15px; border-radius: 15px;
            box-shadow: var(--shadow); text-align: center; margin-top: 10px;
        }

        .en-text { font-size: 18px; color: #ffffff; margin: 15px 0; display: block; direction: ltr; }

        .option-btn { width: 100%; margin: 5px 0; padding: 10px; }

        .hidden { display: none !important; }
        h1 { font-size: 20px; margin: 5px 0; }
    </style>
</head>
<body>

<div class="header-bar">
    <button id="muteBtn" class="neu-btn" onclick="app.toggleMute()">ðŸ”Š Mute</button>
    <button class="neu-btn btn-exit" onclick="app.exit()">âœ– Ø®Ø±ÙˆØ¬</button>
</div>

<div id="home">
    <div class="card">
        <h1 style="color: #00d2ff;">Fred Elite</h1>
        <p style="font-size: 10px; color: #888;">Compact Mode (Auto-Refresh)</p>
        <button class="neu-btn" style="width: 100%;" onclick="app.start()">ðŸš€ Ø´Ø±ÙˆØ¹</button>
    </div>
</div>

<div id="quiz" class="hidden">
    <div class="card">
        <div id="qText" class="en-text"></div>
        <div id="qOptions"></div>
        <div id="feedback" style="margin-top: 10px; font-size: 12px;"></div>
    </div>
</div>

<script>
    // Ù„Ø§ÛŒÙ‡ Ø¯ÙˆÙ…: Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø´ Service Worker Ù‡Ø§ Ø¨Ù‡ Ù…Ø­Ø¶ Ø¨Ø§Ø² Ø´Ø¯Ù† ØµÙØ­Ù‡
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister();
            }
        });
    }

    // Ù„Ø§ÛŒÙ‡ Ø³ÙˆÙ…: Ù„ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ø¨Ø§ Ú©Ø¯ ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ± Ø²Ø¯Ù† Ú©Ø´
    const script = document.createElement('script');
    script.src = 'dictionary.js?v=' + Date.now();
    document.head.appendChild(script);

    const app = {
        isMuted: false,
        currentWord: null,

        toggleMute() {
            this.isMuted = !this.isMuted;
            document.getElementById('muteBtn').innerText = this.isMuted ? "ðŸ”‡" : "ðŸ”Š";
        },

        exit() { if(confirm("Ø®Ø±ÙˆØ¬ØŸ")) location.reload(); },

        speak(text) {
            if (!this.isMuted && 'speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'en-US'; u.rate = 0.8;
                window.speechSynthesis.speak(u);
            }
        },

        start() {
            document.getElementById('home').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            this.next();
        },

        next() {
            if (typeof dictionary === 'undefined') return alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ØºØ§Øª!");
            const word = dictionary[Math.floor(Math.random() * dictionary.length)];
            this.currentWord = word;
            this.speak(word.en);
            document.getElementById('qText').innerText = word.ex.replace(new RegExp(word.en, 'gi'), "___");
            let wrongs = dictionary.filter(d => d.en !== word.en).sort(() => 0.5 - Math.random()).slice(0, 2);
            let opts = [word, ...wrongs].sort(() => 0.5 - Math.random());
            const container = document.getElementById('qOptions');
            container.innerHTML = "";
            opts.forEach(o => {
                const btn = document.createElement('button');
                btn.className = 'neu-btn option-btn';
                btn.innerText = o.en;
                btn.onclick = () => this.check(o.en);
                container.appendChild(btn);
            });
        },

        check(ans) {
            const f = document.getElementById('feedback');
            if(ans === this.currentWord.en) {
                f.innerText = "âœ… Excellent!"; f.style.color = "#00ff88";
            } else {
                f.innerText = "âŒ No"; f.style.color = "#ff4d4d";
                this.speak(this.currentWord.en);
            }
            setTimeout(() => { f.innerText = ""; this.next(); }, 1200);
        }
    };
</script>

</body>
</html>
